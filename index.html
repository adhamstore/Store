<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Search</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, query, where } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAeNnTbv...",
            authDomain: "store-fdde6.firebaseapp.com",
            projectId: "store-fdde6",
            storageBucket: "store-fdde6.appspot.com",
            messagingSenderId: "89613962927",
            appId: "1:89613962927:web:5646e8be819cc88ca28e5a",
            measurementId: "G-25Y158ELFL"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let items = [];

        async function fetchFirestoreData() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';
            
            const querySnapshot = await getDocs(collection(db, "items"));
            items = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            items.sort((a, b) => a.name.localeCompare(b.name));
            renderItems(items);
        }

        function renderItems(filteredItems) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';
            filteredItems.forEach(item => {
                const li = document.createElement('li');
                li.classList.add('item');
                li.innerHTML = `
                    <div class="item-info">
                        <label>Name:</label> <input type="text" value="${item.name}" disabled>
                        <label>Serial:</label> <input type="text" value="${item.serial}" disabled>
                        <label>In Storage:</label> <input type="text" value="${item.stock}" disabled>
                    </div>
                `;
                resultsContainer.appendChild(li);
            });
        }

        document.getElementById('search').addEventListener('input', function () {
            const query = this.value.toLowerCase();
            const filteredItems = items.filter(item => item.name.toLowerCase().includes(query));
            renderItems(filteredItems);
        });

        async function addItemToFirestore(name, serial, stock) {
            await addDoc(collection(db, "items"), { name, serial, stock });
            fetchFirestoreData();
        }

        function openAddItemForm() {
            document.getElementById('addItemForm').style.display = 'block';
        }

        function closeAddItemForm() {
            document.getElementById('addItemForm').style.display = 'none';
        }

        document.getElementById('addItemButton').addEventListener('click', openAddItemForm);
        document.getElementById('closeAddItem').addEventListener('click', closeAddItemForm);
        document.getElementById('submitItem').addEventListener('click', function () {
            const name = document.getElementById('itemName').value;
            const serial = document.getElementById('itemSerial').value;
            const stock = parseInt(document.getElementById('itemStock').value);
            addItemToFirestore(name, serial, stock);
            closeAddItemForm();
        });

        fetchFirestoreData();
    </script>
    
    <style>
        body { font-family: 'Arial', sans-serif; }
        .controls { display: flex; gap: 10px; }
        .container { margin-top: 20px; }
        .item-list { list-style: none; padding: 0; }
        .item { border: 1px solid #ddd; padding: 10px; margin-bottom: 5px; }
        .form-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="controls">
        <input type="text" id="search" placeholder="Search for an item...">
        <button id="addItemButton">Add Item</button>
    </div>
    <div class="container">
        <ul id="results" class="item-list"></ul>
    </div>

    <div id="addItemForm" class="form-popup">
        <label>Name:</label> <input type="text" id="itemName"><br>
        <label>Serial:</label> <input type="text" id="itemSerial"><br>
        <label>Stock:</label> <input type="number" id="itemStock"><br>
        <button id="submitItem">Submit</button>
        <button id="closeAddItem">X</button>
    </div>
</body>
</html>
